<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Notificações Automáticas UTMify</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding-top: 50px;
    }
    button {
      background-color: #0050ff;
      color: white;
      border: none;
      padding: 15px 30px;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
    }
  </style>

  <!-- OneSignal SDK -->
  <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
  <script>
    window.OneSignalDeferred = window.OneSignalDeferred || [];
    OneSignalDeferred.push(async function(OneSignal) {
      await OneSignal.init({
        appId: "1866aa17-dd5b-4a6b-be26-5007328cc164", // seu app ID do OneSignal
        notifyButton: {
          enable: true // botão de inscrição visível se quiser
        }
      });
    });
  </script>
</head>
<body>
  <h2>UTMify Notificações Automáticas</h2>
  <p>Permita as notificações e deixe o site aberto ou feche o Safari após permitir. As notificações continuarão.</p>
  <button id="startBtn">Ativar Notificações</button>

  <script>
    const valores = ["R$18,99", "R$24,99", "R$44,99", "R$38,00"];
    let intervaloMin = 15; // mínimo em minutos entre notificações
    let intervaloMax = 30; // máximo em minutos

    document.getElementById("startBtn").addEventListener("click", async () => {
      if (!("Notification" in window)) {
        alert("Seu navegador não suporta notificações.");
        return;
      }

      let permission = Notification.permission;
      if (permission === "default") {
        permission = await Notification.requestPermission();
      }

      if (permission !== "granted") {
        alert("Permissão negada.");
        return;
      }

      alert("Notificações ativadas! Deixe essa aba aberta ou feche o Safari — você continuará recebendo.");

      startNotificacoesAutomaticas();
    });

    function startNotificacoesAutomaticas() {
      function exibirNotificacao() {
        const valor = valores[Math.floor(Math.random() * valores.length)];
        new Notification("Venda aprovada", {
          body: `Valor: ${valor}`,
          icon: "https://i.ibb.co/j9JC8qw3/utmify.png",
          tag: "utmify-auto",
          renotify: true
        });

        // Agendar próxima notificação
        const proximoTempoMin = intervaloMin * 60 * 1000;
        const proximoTempoMax = intervaloMax * 60 * 1000;
        const tempoAleatorio = Math.floor(Math.random() * (proximoTempoMax - proximoTempoMin)) + proximoTempoMin;

        setTimeout(exibirNotificacao, tempoAleatorio);
      }

      exibirNotificacao();
    }
  </script>
</body>
</html>
